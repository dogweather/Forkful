---
aliases:
- /ru/bash/editing-files-in-place-with-cli-one-liners/
changelog:
- 2024-01-28, gpt-4-0125-preview, translated from English
date: 2024-01-28 23:58:49.299313-07:00
description: "\u041F\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044C\u0442\u0435,\
  \ \u0447\u0442\u043E \u0432\u044B \u0442\u043E\u043B\u044C\u043A\u043E \u0447\u0442\
  \u043E \u0443\u0437\u043D\u0430\u043B\u0438, \u0447\u0442\u043E \u0432\u0430\u043C\
  \ \u043D\u0443\u0436\u043D\u043E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\
  \u044C \u043F\u0430\u043A\u0435\u0442\u043D\u043E\u0435 \u043E\u0431\u043D\u043E\
  \u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\
  \u0438\u0445 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043E\
  \u043D\u043D\u044B\u0445 \u0444\u0430\u0439\u043B\u043E\u0432 \u043D\u0430 \u0432\
  \u0430\u0448\u0435\u043C \u0441\u0435\u0440\u0432\u0435\u0440\u0435. \u0412\u044B\
  \ \u043C\u043E\u0433\u043B\u0438 \u0431\u044B\u2026"
lastmod: 2024-02-18 23:08:57.198710
model: gpt-4-0125-preview
summary: "\u041F\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044C\u0442\u0435, \u0447\
  \u0442\u043E \u0432\u044B \u0442\u043E\u043B\u044C\u043A\u043E \u0447\u0442\u043E\
  \ \u0443\u0437\u043D\u0430\u043B\u0438, \u0447\u0442\u043E \u0432\u0430\u043C \u043D\
  \u0443\u0436\u043D\u043E \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C\
  \ \u043F\u0430\u043A\u0435\u0442\u043D\u043E\u0435 \u043E\u0431\u043D\u043E\u0432\
  \u043B\u0435\u043D\u0438\u0435 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u0438\
  \u0445 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043E\u043D\
  \u043D\u044B\u0445 \u0444\u0430\u0439\u043B\u043E\u0432 \u043D\u0430 \u0432\u0430\
  \u0448\u0435\u043C \u0441\u0435\u0440\u0432\u0435\u0440\u0435. \u0412\u044B \u043C\
  \u043E\u0433\u043B\u0438 \u0431\u044B\u2026"
title: "\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\
  \u0435 \u0444\u0430\u0439\u043B\u043E\u0432 \u043D\u0430 \u043C\u0435\u0441\u0442\
  \u0435 \u0441 \u043F\u043E\u043C\u043E\u0449\u044C\u044E \u043E\u0434\u043D\u043E\
  \u0441\u0442\u0440\u043E\u0447\u043D\u0438\u043A\u043E\u0432 CLI"
---

{{< edit_this_page >}}

## Что и почему?

Представьте, что вы только что узнали, что вам нужно выполнить пакетное обновление нескольких конфигурационных файлов на вашем сервере. Вы могли бы открыть каждый файл, внести изменения вручную и сохранить их. Или вы можете выполнять редактирование на месте прямо из командной строки (CLI), что экономит время, снижает вероятность ошибок и автоматизирует повторяющиеся задачи. Эта техника особенно полезна для системных обновлений, исправлений или массовых модификаций, где ручные правки могут быть нецелесообразными или склонными к ошибкам.

## Как это сделать:

При речи о редактировании файлов на месте с использованием Bash ключевыми инструментами являются `sed` и `awk`. Давайте рассмотрим, как использовать эти мощные утилиты на примере кода.

### Использование `sed` для простой замены текста

Следующая команда заменяет первое вхождение "text1" на "text2" в `file.txt`:

```Bash
sed -i 's/text1/text2/' file.txt
```

Для глобальной замены (все вхождения) добавьте `g` в конце:

```Bash
sed -i 's/text1/text2/g' file.txt
```

Чтобы изменить несколько файлов одновременно:

```Bash
sed -i 's/text1/text2/g' file1.txt file2.txt file3.txt
```

### Использование `awk` для более сложных манипуляций

`awk` — это еще один инструмент, который отличается своими программными возможностями, особенно полезными для обработки текста, включающего данные, основанные на полях.

Изменение второго поля каждой строки на `newValue` в `data.csv`, разделенных запятыми:

```Bash
awk -i inplace -F, '{$2="newValue"; print $0}' OFS=, data.csv
```

### Создайте резервную копию, прежде чем прыгать

Один практический совет: всегда создавайте резервную копию перед редактированием на месте. `sed` облегчает это с помощью опции `-i`, за которой следует суффикс для создания резервной копии.

```Bash
sed -i.bak 's/text1/text2/g' file.txt
```

Эта команда создает резервную копию оригинального `file.txt` как `file.txt.bak` перед выполнением замены.

## Глубокое погружение

Способность редактировать файлы непосредственно из командной строки возникла как естественное развитие философии Unix: предоставление пользователям возможности эффективно управлять и манипулировать данными с минимальным количеством нажатий клавиш. Тем не менее, эта сила имеет свои оговорки.

### Исторический контекст

Инструменты Unix, такие как `sed` и `awk`, существуют с ранних дней Unix и были созданы как часть его философии набора инструментов, сосредоточенной на специализированных, составляемых командах. Их включение в арсенал Unix было ответом на потребность в эффективной обработке текста в ландшафте, доминируемом командной строкой.

### Альтернативы

Хотя `sed` и `awk` мощные, они не единственные варианты. Perl и Python, например, имеют командные опции (`-p` и `-i` соответственно), которые позволяют выполнять аналогичное редактирование на месте с, возможно, более читаемым синтаксисом для сложных операций.

```Bash
perl -pi -e 's/text1/text2/g' file.txt
```

```Bash
python -c "import fileinput, sys; [sys.stdout.write(line.replace('text1', 'text2')) for line in fileinput.input(files='file.txt', inplace=True)]"
```

У каждой альтернативы есть свои сильные стороны: огромные возможности Perl для однострочных команд и, возможно, более доступный синтаксис Python для тех, кто не особо знаком с инструментами обработки текста Unix.

### Детали реализации

Редактирование на месте технически не является "на месте" в буквальном смысле. Оба `sed -i` и `awk -i inplace` работают, создавая временный файл, в котором хранится обработанный вывод, прежде чем заменить оригинальный файл. Этот подход гарантирует, что файл не будет поврежден, если процесс будет прерван. Импликации в основном касаются ресурсов и разрешений: вы должны иметь достаточно места на диске для временного файла и разрешения на создание файлов в директории вашего целевого файла.

Несмотря на свою мощь, команды для редактирования на месте следует использовать с осторожностью. Неправильно поставленное регулярное выражение может привести к потере данных, что подчеркивает важность резервных копий. Несмотря на потенциальные подводные камни, освоение этих команд может значительно повысить вашу способность выполнять быстрые, эффективные модификации файлов непосредственно из командной строки, воплощая философию Unix использования простых, мощных инструментов для выполнения сложных задач.
