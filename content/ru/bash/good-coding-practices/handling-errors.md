---
aliases:
- /ru/bash/handling-errors/
changelog:
- 2024-01-28, gpt-4-0125-preview, translated from English
date: 2024-01-28 23:59:28.422336-07:00
description: "\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430 \u043E\u0448\u0438\
  \u0431\u043E\u043A \u0432 Bash-\u0441\u043A\u0440\u0438\u043F\u0442\u0430\u0445\
  \ \u0437\u0430\u043A\u043B\u044E\u0447\u0430\u0435\u0442\u0441\u044F \u0432 \u043F\
  \u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043D\u0438\u0438, \u0433\u0434\u0435\
  \ \u0447\u0442\u043E-\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u043F\u043E\u0439\
  \u0442\u0438 \u043D\u0435 \u0442\u0430\u043A, \u0438 \u0432 \u0438\u0437\u044F\u0449\
  \u043D\u043E\u043C \u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0438\
  \ \u044D\u0442\u0438\u043C. \u041F\u043E\u0447\u0435\u043C\u0443? \u041D\u0443,\
  \ \u044D\u0442\u043E \u0434\u0435\u043B\u0430\u0435\u0442 \u0432\u0430\u0448 \u0441\
  \u043A\u0440\u0438\u043F\u0442\u2026"
lastmod: 2024-02-18 23:08:57.213787
model: gpt-4-0125-preview
summary: "\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430 \u043E\u0448\u0438\
  \u0431\u043E\u043A \u0432 Bash-\u0441\u043A\u0440\u0438\u043F\u0442\u0430\u0445\
  \ \u0437\u0430\u043A\u043B\u044E\u0447\u0430\u0435\u0442\u0441\u044F \u0432 \u043F\
  \u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043D\u0438\u0438, \u0433\u0434\u0435\
  \ \u0447\u0442\u043E-\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u043F\u043E\u0439\
  \u0442\u0438 \u043D\u0435 \u0442\u0430\u043A, \u0438 \u0432 \u0438\u0437\u044F\u0449\
  \u043D\u043E\u043C \u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0438\
  \ \u044D\u0442\u0438\u043C. \u041F\u043E\u0447\u0435\u043C\u0443? \u041D\u0443,\
  \ \u044D\u0442\u043E \u0434\u0435\u043B\u0430\u0435\u0442 \u0432\u0430\u0448 \u0441\
  \u043A\u0440\u0438\u043F\u0442\u2026"
title: "\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430 \u043E\u0448\u0438\u0431\
  \u043E\u043A"
---

{{< edit_this_page >}}

## Что и Почему?

Обработка ошибок в Bash-скриптах заключается в предвидении, где что-то может пойти не так, и в изящном управлении этим. Почему? Ну, это делает ваш скрипт надежным и избавляет пользователей от недоумения, когда что-то не работает как ожидалось.

## Как это делать:

```Bash
#!/bin/bash

# Перенаправление stderr в файл
grep "something" file.txt 2> errors.log

# Обработка ошибок с помощью статусов выхода
if ! grep "something" file.txt; then
    echo "Ой, что-то пошло не так при поиске 'something'."
    exit 1
fi

# Использование trap для очистки перед выходом из-за ошибки
cleanup() {
  echo "Очистка временных файлов..."
  rm temp_*
}

trap cleanup ERR

# намеренная ошибка: файл не существует
cat temp_file.txt
```

Пример вывода при возникновении ошибки:

```
Очистка временных файлов...
cat: temp_file.txt: Нет такого файла или каталога
```

## Глубокое погружение

Обработка ошибок в Bash-скриптах восходит к истокам Unix shell, где надежные и эффективные скрипты были (и остаются) жизненно важны для системного администрирования и автоматизации. Традиционно ошибки в Bash обрабатываются путем проверки статуса выхода команды, который по соглашению возвращает 0 в случае успеха и ненулевое значение в случае неудачи.

Bash ввел команду `trap` как встроенную, позволяя пользователям указывать команды для выполнения при различных сигналах или выходах из скрипта. Это полезно для задач очистки или как механизм обработки ошибок последней инстанции.

Также существует команда `set`, которая может изменить поведение Bash при ошибках. Например, `set -e` заставит скрипт немедленно завершиться, если любая команда завершится с ненулевым статусом, что является способом быстро обнаружить ошибку и избежать каскадных ошибок.

Альтернативы встроенной обработке ошибок в Bash включают явную проверку существования файлов, использование подстановки команд или даже написание собственных функций для более детальной обработки ошибок.

Хотя тщательная обработка ошибок иногда может показаться избыточной для маленьких скриптов, это практика, которая может сэкономить много времени на отладке и предотвратить неожиданное поведение как для вас, так и для пользователей.

## См. также

- Руководство по Bash о параметрах оболочки: https://www.gnu.org/software/bash/manual/bash.html#Shell-Parameters
- Раздел Расширенного руководства по скриптингу в Bash об обработке ошибок: https://www.tldp.org/LDP/abs/html/exit-status.html
- Подробное руководство по `trap`: https://mywiki.wooledge.org/SignalTrap

Помните, скриптинг - это форма искусства, и как вы обрабатываете промахи и спотыкания, может сделать ваше творение более устойчивым. Счастливого скриптинга!
