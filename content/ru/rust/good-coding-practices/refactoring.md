---
changelog:
- 2024-01-29, gpt-4-0125-preview, translated from English
date: 2024-01-29 00:02:16.261080-07:00
description: "\u0420\u0435\u0444\u0430\u043A\u0442\u043E\u0440\u0438\u043D\u0433 -\
  \ \u044D\u0442\u043E \u043F\u0440\u043E\u0446\u0435\u0441\u0441 \u0440\u0435\u0441\
  \u0442\u0440\u0443\u043A\u0442\u0443\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\
  \u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0435\u0433\u043E \u043A\u043E\
  \u043C\u043F\u044C\u044E\u0442\u0435\u0440\u043D\u043E\u0433\u043E \u043A\u043E\u0434\
  \u0430 \u2014 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0444\u0430\
  \u043A\u0442\u043E\u0440\u0438\u043D\u0433\u0430 \u2014 \u0431\u0435\u0437 \u0438\
  \u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0435\u0433\u043E \u0432\u043D\
  \u0435\u0448\u043D\u0435\u0433\u043E \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\
  \u044F. \u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0441\u0442\u044B\
  \u2026"
lastmod: '2024-03-13T22:44:44.681453-06:00'
model: gpt-4-0125-preview
summary: "\u0420\u0435\u0444\u0430\u043A\u0442\u043E\u0440\u0438\u043D\u0433 - \u044D\
  \u0442\u043E \u043F\u0440\u043E\u0446\u0435\u0441\u0441 \u0440\u0435\u0441\u0442\
  \u0440\u0443\u043A\u0442\u0443\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u0443\
  \u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0435\u0433\u043E \u043A\u043E\u043C\
  \u043F\u044C\u044E\u0442\u0435\u0440\u043D\u043E\u0433\u043E \u043A\u043E\u0434\u0430\
  \ \u2014 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0444\u0430\u043A\
  \u0442\u043E\u0440\u0438\u043D\u0433\u0430 \u2014 \u0431\u0435\u0437 \u0438\u0437\
  \u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0435\u0433\u043E \u0432\u043D\u0435\
  \u0448\u043D\u0435\u0433\u043E \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u044F\
  ."
title: "\u0420\u0435\u0444\u0430\u043A\u0442\u043E\u0440\u0438\u043D\u0433"
weight: 19
---

## Как сделать:
Давайте отрефакторим простой фрагмент кода на Rust, чтобы сделать его более идиоматичным и удобным для поддержки. Начнем с функции, которая вычисляет сумму вектора целых чисел:

```rust
fn sum(vec: &Vec<i32>) -> i32 {
    let mut sum = 0;
    for i in vec {
        sum += i;
    }
    sum
}

fn main() {
    let numbers = vec![1, 2, 3, 4, 5];
    println!("Сумма равна {}", sum(&numbers));
}
```

Вывод:
```
Сумма равна 15
```

Теперь давайте отрефакторим это, используя более идиоматичный Rust, применяя итераторы и метод `fold`:

```rust
fn sum(vec: &[i32]) -> i32 {
    vec.iter().fold(0, |acc, &x| acc + x)
}

fn main() {
    let numbers = vec![1, 2, 3, 4, 5];
    println!("Сумма равна {}", sum(&numbers));
}
```

Вывод без изменений — все равно `15` — но отрефакторенная версия чище и использует сильные стороны Rust, такие как заимствование и методы итераторов.

## Глубокое погружение
Рефакторинг берет свои корни в сообществе Smalltalk и был популяризирован в мире Java благодаря книге Мартина Фаулера "Рефакторинг: Улучшение проекта существующего кода". Его принципы универсальны и применимы к Rust, где безопасность и параллелизм имеют первостепенное значение. Rust поощряет написание надежного кода, обнаруживая проблемы во время компиляции, так что во время рефакторинга компилятор Rust служит сетью безопасности.

Альтернативы ручному рефакторингу включают использование автоматизированных инструментов, таких как 'rustfmt' для форматирования кода и 'clippy' для линтинга, которые могут предложить более идиоматичные способы написания кода. Однако глубокий рефакторинг часто требует осмысленного понимания дизайна кода, что эти инструменты не могут полностью автоматизировать.

В Rust рефакторинг может касаться улучшения использования типов, эффективного использования времен жизни, сокращения ненужных аллокаций или применения паттернов параллелизма, таких как использование `Arc<Mutex<T>>` при необходимости. Также распространено переход от `unwrap()` к более выразительной обработке ошибок с `Result<T, E>`.

## Смотрите также
Чтобы углубленно изучить рефакторинг в Rust:

- Книга по Rust: https://doc.rust-lang.org/book/
- Rust на практике: https://doc.rust-lang.org/rust-by-example/
- Clippy, инструмент для линтинга Rust: https://github.com/rust-lang/rust-clippy
- "Рефакторинг: Улучшение проекта существующего кода" от Мартина Фаулера: https://martinfowler.com/books/refactoring.html
